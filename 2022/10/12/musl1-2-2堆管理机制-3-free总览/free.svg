<svg id="SvgjsSvg1006" width="1325.0125274658203" height="619.8000373840332" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"><marker id="SvgjsMarker1032" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1033" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1042" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1043" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1078" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1079" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1102" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1103" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1122" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1123" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1132" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1133" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1144" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1145" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker><marker id="SvgjsMarker1148" markerWidth="14" markerHeight="10" refX="10" refY="5" viewBox="0 0 14 10" orient="auto" markerUnits="userSpaceOnUse" stroke-dasharray="0,0"><path id="SvgjsPath1149" d="M0,0 L14,5 L0,10 L0,0" fill="#323232" stroke="#323232" stroke-width="1"></path></marker></defs><g id="SvgjsG1008" transform="translate(25.012496948242188,25)"><path id="SvgjsPath1009" d="M 0 0L 120 0L 120 40L 0 40Z" stroke="none" fill="none"></path><g id="SvgjsG1010"><text id="SvgjsText1011" font-family="微软雅黑" text-anchor="middle" font-size="21px" width="120px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="21px" weight="400" font-style="" opacity="1" y="1.375" transform="rotate(0)"><tspan id="SvgjsTspan1012" dy="26" x="60"><tspan id="SvgjsTspan1013" style="text-decoration:;">free</tspan></tspan></text></g></g><g id="SvgjsG1014" transform="translate(114.01249694824219,78)"><path id="SvgjsPath1015" d="M 0 0L 178 0L 178 37L 0 37Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1016"><text id="SvgjsText1017" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="158px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="7.875" transform="rotate(0)"><tspan id="SvgjsTspan1018" dy="16" x="89"><tspan id="SvgjsTspan1019" style="text-decoration:;">获取对应的meta</tspan></tspan></text></g></g><g id="SvgjsG1020" transform="translate(63.51249694824219,205)"><path id="SvgjsPath1021" d="M 0 0L 279 0L 279 77L 0 77Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1022"><text id="SvgjsText1023" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="259px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="11.375" transform="rotate(0)"><tspan id="SvgjsTspan1024" dy="16" x="139.5"><tspan id="SvgjsTspan1025" style="text-decoration:;">如果当前的group 中既有被free的chunk，</tspan></tspan><tspan id="SvgjsTspan1026" dy="16" x="139.5"><tspan id="SvgjsTspan1027" style="text-decoration:;">也有正在使用的chunk，就更新freed_mask </tspan></tspan><tspan id="SvgjsTspan1028" dy="16" x="139.5"><tspan id="SvgjsTspan1029" style="text-decoration:;">(加上当前这个被释放的chunk)</tspan></tspan></text></g></g><g id="SvgjsG1030"><path id="SvgjsPath1031" d="M203.0124969482422 116L203.0124969482422 160L203.0124969482422 160L203.0124969482422 201.4" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1032)"></path></g><g id="SvgjsG1034" transform="translate(121.51249694824219,357)"><path id="SvgjsPath1035" d="M 0 0L 163 0L 163 54L 0 54Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1036"><text id="SvgjsText1037" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="143px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="16.375" transform="rotate(0)"><tspan id="SvgjsTspan1038" dy="16" x="81.5"><tspan id="SvgjsTspan1039" style="text-decoration:;">nontrivial_free</tspan></tspan></text></g></g><g id="SvgjsG1040"><path id="SvgjsPath1041" d="M203.0124969482422 283L203.0124969482422 319.5L203.0124969482422 319.5L203.0124969482422 353.4" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1042)"></path></g><g id="SvgjsG1044" transform="translate(303.0124969482422,354)"><path id="SvgjsPath1045" d="M 0 19.8L 89 19.8L 89 0L 119 30L 89 60L 89 40.2L 0 40.2L 0 19.8Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1046"><text id="SvgjsText1047" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="119px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="19.375" transform="rotate(0)"><tspan id="SvgjsTspan1048" dy="16" x="59.5"><tspan id="SvgjsTspan1049" style="text-decoration:;">nontrivial_free</tspan></tspan></text></g></g><g id="SvgjsG1050" transform="translate(497.5124969482422,61)"><path id="SvgjsPath1051" d="M 0 0L 280 0L 280 63L 0 63Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1052"><text id="SvgjsText1053" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="260px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="12.375" transform="rotate(0)"><tspan id="SvgjsTspan1054" dy="16" x="140"><tspan id="SvgjsTspan1055" style="text-decoration:;">mask = g-&gt;freed_mask | g-&gt;avail_mask;</tspan></tspan><tspan id="SvgjsTspan1056" dy="16" x="140"><tspan id="SvgjsTspan1057" style="text-decoration:;">mask现在记录的是没有被使用的chunk..</tspan></tspan></text></g></g><g id="SvgjsG1058" transform="translate(489.0124969482422,187.20000076293945)"><path id="SvgjsPath1059" d="M 0 0L 297 0L 297 62L 0 62Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1060"><text id="SvgjsText1061" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="277px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="11.875" transform="rotate(0)"><tspan id="SvgjsTspan1062" dy="16" x="148.5"><tspan id="SvgjsTspan1063" style="text-decoration:;">如果mask 全为1 ，也就是当前group中没有被</tspan></tspan><tspan id="SvgjsTspan1064" dy="16" x="148.5"><tspan id="SvgjsTspan1065" style="text-decoration:;">使用的chunk，而且 okey_to_free</tspan></tspan></text></g></g><g id="SvgjsG1066" transform="translate(995.0124969482422,172.30000114440918)"><path id="SvgjsPath1067" d="M 0 0L 305.2000093460083 0L 305.2000093460083 91.79999923706055L 0 91.79999923706055Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1068"><text id="SvgjsText1069" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="286px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="18.774999618530273" transform="rotate(0)"><tspan id="SvgjsTspan1070" dy="16" x="153"><tspan id="SvgjsTspan1071" style="text-decoration:;">deque这个group，如果这个group刚好是</tspan></tspan><tspan id="SvgjsTspan1072" dy="16" x="153"><tspan id="SvgjsTspan1073" style="text-decoration:;">active[sc]，那么就active新的group。然后函数</tspan></tspan><tspan id="SvgjsTspan1074" dy="16" x="153"><tspan id="SvgjsTspan1075" style="text-decoration:;">返回free_group</tspan></tspan></text></g></g><g id="SvgjsG1076"><path id="SvgjsPath1077" d="M787.0124969482422 218.20000076293945L890.5124969482422 218.20000076293945L890.5124969482422 218.20000076293945L991.4124969482422 218.20000076293945" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1078)"></path></g><g id="SvgjsG1080" transform="translate(440.5124969482422,326.20000076293945)"><path id="SvgjsPath1081" d="M 0 0L 495 0L 495 136.5999984741211L 0 136.5999984741211Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1082"><text id="SvgjsText1083" font-family="微软雅黑" text-anchor="start" font-size="13px" width="475px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="start" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="0.6749992370605469" transform="rotate(0)"><tspan id="SvgjsTspan1084" dy="16" x="10"><tspan id="SvgjsTspan1085" style="text-decoration:;">mask == 0，说明当前group中的chunk都在被使用(包括现在这个被free的chunk)</tspan></tspan><tspan id="SvgjsTspan1086" dy="16" x="10"><tspan id="SvgjsTspan1087" style="text-decoration:;">在分配的时候，如果mask == 0,说明此时active 里面没有可用被使用的chunk了。</tspan></tspan><tspan id="SvgjsTspan1088" dy="16" x="10"><tspan id="SvgjsTspan1089" style="text-decoration:;">此时如果再次分配的话,就会从active里面取出这个group.</tspan></tspan><tspan id="SvgjsTspan1090" dy="16" x="10"><tspan id="SvgjsTspan1091" style="text-decoration:;"> </tspan></tspan><tspan id="SvgjsTspan1092" dy="16" x="10"><tspan id="SvgjsTspan1093" style="text-decoration:;">所以执行到这里(释放.)的时候，有两种情况</tspan></tspan><tspan id="SvgjsTspan1094" dy="16" x="10"><tspan id="SvgjsTspan1095" style="text-decoration:;">1. active里面当前的就是这个group,</tspan></tspan><tspan id="SvgjsTspan1096" dy="16" x="10"><tspan id="SvgjsTspan1097" style="text-decoration:;">2. group 已经被取走了.</tspan></tspan><tspan id="SvgjsTspan1098" dy="16" x="10"><tspan id="SvgjsTspan1099" style="text-decoration:;"> </tspan></tspan></text></g></g><g id="SvgjsG1100"><path id="SvgjsPath1101" d="M637.5124969482422 250.20000076293945L637.5124969482422 287.70000076293945L688.0124969482422 287.70000076293945L688.0124969482422 322.60000076293943" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1102)"></path><rect id="SvgjsRect1104" width="24" height="16" x="649.4624969482422" y="279.70000076293945" fill="#ffffff"></rect><text id="SvgjsText1105" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="24px" fill="#323232" font-weight="400" align="top" lineHeight="16px" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="277.07500076293945" transform="rotate(0)"><tspan id="SvgjsTspan1106" dy="16" x="661.4624969482422"><tspan id="SvgjsTspan1107" style="text-decoration:;">else</tspan></tspan></text></g><g id="SvgjsG1108" transform="translate(1037.0124969482422,344)"><path id="SvgjsPath1109" d="M 0 0L 208 0L 208 101L 0 101Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1110"><text id="SvgjsText1111" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="188px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="15.375" transform="rotate(0)"><tspan id="SvgjsTspan1112" dy="16" x="104"><tspan id="SvgjsTspan1113" style="text-decoration:;">如果active[sc] 不是这个</tspan></tspan><tspan id="SvgjsTspan1114" dy="16" x="104"><tspan id="SvgjsTspan1115" style="text-decoration:;">group，说明group在分配的时</tspan></tspan><tspan id="SvgjsTspan1116" dy="16" x="104"><tspan id="SvgjsTspan1117" style="text-decoration:;">候被从链表里面摘下来了，这里</tspan></tspan><tspan id="SvgjsTspan1118" dy="16" x="104"><tspan id="SvgjsTspan1119" style="text-decoration:;">再加到链表里面 </tspan></tspan></text></g></g><g id="SvgjsG1120"><path id="SvgjsPath1121" d="M936.5124969482422 394.5L986.2624969482422 394.5L986.2624969482422 394.5L1033.4124969482423 394.5" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1122)"></path></g><g id="SvgjsG1124" transform="translate(529.3625016212463,547.7999992370605)"><path id="SvgjsPath1125" d="M 0 0L 317.2999906539917 0L 317.2999906539917 47L 0 47Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1126"><text id="SvgjsText1127" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="298px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="12.875" transform="rotate(0)"><tspan id="SvgjsTspan1128" dy="16" x="159"><tspan id="SvgjsTspan1129" style="text-decoration:;">freed_mask |= self，标记这个chunk被free了</tspan></tspan></text></g></g><g id="SvgjsG1130"><path id="SvgjsPath1131" d="M688.0124969482422 463.79999923706055L688.0124969482422 505.29999923706055L688.0124969482422 505.29999923706055L688.0124969482422 544.1999992370605" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1132)"></path></g><g id="SvgjsG1134" transform="translate(90.06249237060547,490.79999923706055)"><path id="SvgjsPath1135" d="M 0 0L 225.90000915527344 0L 225.90000915527344 57L 0 57Z" stroke="rgba(50,50,50,1)" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1136"><text id="SvgjsText1137" font-family="微软雅黑" text-anchor="middle" font-size="13px" width="206px" fill="#323232" font-weight="400" align="middle" lineHeight="125%" anchor="middle" family="微软雅黑" size="13px" weight="400" font-style="" opacity="1" y="9.375" transform="rotate(0)"><tspan id="SvgjsTspan1138" dy="16" x="113"><tspan id="SvgjsTspan1139" style="text-decoration:;">如果是mmap分配的group，</tspan></tspan><tspan id="SvgjsTspan1140" dy="16" x="113"><tspan id="SvgjsTspan1141" style="text-decoration:;">unmmap</tspan></tspan></text></g></g><g id="SvgjsG1142"><path id="SvgjsPath1143" d="M203.0124969482422 412L203.0124969482422 450.8999996185303L203.0124969482422 450.8999996185303L203.0124969482422 487.1999992370605" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1144)"></path></g><g id="SvgjsG1146"><path id="SvgjsPath1147" d="M637.5124969482422 125L637.5124969482422 155.60000038146973L637.5124969482422 155.60000038146973L637.5124969482422 183.60000076293946" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#SvgjsMarker1148)"></path></g></svg>